"use strict";(()=>{var e={};e.id=4070,e.ids=[4070],e.modules={99344:e=>{e.exports=require("jsonwebtoken")},20145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},88009:(e,s,a)=>{a.r(s),a.d(s,{config:()=>u,default:()=>c,routeModule:()=>d});var t={};a.r(t),a.d(t,{default:()=>handleEmail});var i=a(71802),n=a(47153),r=a(56249);let l=require("@sendgrid/mail");var m=a.n(l),o=a(4781);async function handleContactEmail(e,s){try{if(!e.email||!e.subject||!e.message)throw Error("Missing required fields for contact email.");let a={from:{email:process.env.SENDGRID_EMAIL,name:"Holiday Air"},personalizations:[{to:[{email:e.email}],dynamic_template_data:{name:e.name,email:e.email,subject:e.subject,message:e.message}}],template_id:process.env.SENDGRID_TEMPLATE_CONTACT_USER},t={from:{email:process.env.SENDGRID_EMAIL},personalizations:[{to:[{email:process.env.SENDGRID_EMAIL}],dynamic_template_data:{name:e.name,email:e.email,subject:e.subject,message:e.message}}],template_id:process.env.SENDGRID_TEMPLATE_CONTACT_ADMIN};await Promise.all([m().send(a),m().send(t)]),s.status(200).json({success:!0,message:"Contact email sent successfully."})}catch(e){s.status(500).json({success:!1,message:`Error sending the contact email. ${e.message}`})}}async function handleNewsletterEmail(e,s){try{if(!e.email)throw Error("Missing required fields for contact email.");let a={from:{email:process.env.SENDGRID_EMAIL,name:"Holiday Air"},personalizations:[{to:[{email:e.email}],dynamic_template_data:{name:e.name,email:e.email,subject:e.subject,message:e.message}}],template_id:process.env.SENDGRID_TEMPLATE_NEWSLETTER_USER},t={from:{email:process.env.SENDGRID_EMAIL},personalizations:[{to:[{email:process.env.SENDGRID_EMAIL}],dynamic_template_data:{name:e.name,email:e.email,subject:e.subject,message:e.message}}],template_id:process.env.SENDGRID_TEMPLATE_NEWSLETTER_ADMIN};await Promise.all([m().send(a),m().send(t)]),s.status(200).json({success:!0,message:"Newsletter email sent successfully."})}catch(e){s.status(e.status).json({success:!1,message:`Error sending the newsletter email. ${e.message}`})}}async function handleEmail(e,s){(0,o.Z)(e,s,async()=>{let a=e.body;if(!a.type)return s.status(400).json({success:!1,message:'Missing "type" field in the request body.'});if(!a.email)return s.status(400).json({success:!1,message:"Missing required fields for newsletter email."});try{if("contact"===a.type)await handleContactEmail(a,s);else{if("newsletter"!==a.type)return s.status(400).json({success:!1,message:"Invalid request type."});await handleNewsletterEmail(a,s)}}catch(e){s.status(e.status).json({success:!1,message:`Internal Server Error: ${e.message}`})}})}m().setApiKey(process.env.SENDGRID_API_KEY);let c=(0,r.l)(t,"default"),u=(0,r.l)(t,"config"),d=new i.PagesAPIRouteModule({definition:{kind:n.x.PAGES_API,page:"/api/mail",pathname:"/api/mail",bundlePath:"",filename:""},userland:t})},4781:(e,s,a)=>{a.d(s,{Z:()=>authenticate});var t=a(99344),i=a.n(t);let n=process.env.JWT_SECRET;function authenticate(e,s,a){let t=e.headers.authorization?.split(" ")[1];if(!t)return s.status(401).json({error:"Unauthorized - Token missing"});try{let s=i().verify(t,n);e.user=s,a()}catch(e){return s.status(401).json({error:"Unauthorized - Invalid token"})}}}};var s=require("../../webpack-api-runtime.js");s.C(e);var __webpack_exec__=e=>s(s.s=e),a=s.X(0,[4222],()=>__webpack_exec__(88009));module.exports=a})();